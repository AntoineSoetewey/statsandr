<!doctype html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Data manipulation in R - Stats and R </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="A blog on statistics and R aiming at helping academics and professionals working with data to grasp important concepts in statistics and to apply them in R." />
    <meta property="og:site_name" content="Stats and R" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/blog/data-manipulation-in-r/" />
    <meta property="og:title" content="Data manipulation in R" />
    <meta property="og:image" content="/blog/data-manipulation-in-rstudio_files/0_voEJp2o-Z2k4-uUd.jpeg" />
    <meta property="og:description" content="A blog on statistics and R aiming at helping academics and professionals working with data to grasp important concepts in statistics and to apply them in R." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="Data manipulation in R" />
    <meta name="twitter:description" content="A blog on statistics and R aiming at helping academics and professionals working with data to grasp important concepts in statistics and to apply them in R." />
    <meta name="twitter:image" content="/blog/data-manipulation-in-rstudio_files/0_voEJp2o-Z2k4-uUd.jpeg" />

    <link rel="canonical" href="/blog/data-manipulation-in-r/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha256-YLGeXaapI0/5IgZopewRJcFXomhRMlYYjugPLSyNjTY=" crossorigin="anonymous" />

    <link rel="stylesheet" href="/css/custom.css" />

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/tomorrow.min.css" integrity="sha256-0QU8ry64q+N6YBIEF/6XF6vUeF15gbNO4tLS6ikk0FI=" crossorigin="anonymous" />
    

    

    <link rel="shortcut icon"
        href="/image/favicon.png">

    
        <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Stats and R" />
    
</head>

<body>
    
    <div class="my-4 my-md-5 header">
    <div class="container">
        <div class="row">
            <div class="col-auto offset-md-1 d-none d-md-block">
                
                    <a href="/">
                        <img class="ml-md-4 logo img-fluid d-block rounded-circle" src="/image/avatar.png" alt="logo">
                    </a>
                
            </div>
            <div class="col-auto align-self-center mr-auto">
                <a href="/">
                    <h1 class="name">Stats and R</h1>
                </a>

                <ul class="nav nav-primary">
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-Posts" href="/blog/">
                                
                                Posts
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-tags" href="/tags/">
                                
                                Tags
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-about" href="/about/">
                                
                                About
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-contact" href="/contact/">
                                
                                Contact
                            </a>
                        </li>
                    

                    
                </ul>

            </div>
        </div>
    </div>
</div>


    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-10">
                    <h1 class="mx-0 mx-md-4 blog-post-title">Data manipulation in R</h1>

                    <div class="mb-md-4 meta">
                        
                            
                                <span class="author" title="Antoine Soetewey">
                                    Antoine Soetewey
                                </span>
                            
                        

                        <span class="date middot" title='Tue Dec 24 2019 00:00:00 UTC'>
                            2019-12-24
                        </span>

                        <span class="reading-time middot">
                            18 minute read
                        </span>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                    <li class="d-inline middot">
                                        <a href="/tags/r">R</a>
                                    </li>
                                
                                    <li class="d-inline middot">
                                        <a href="/tags/basics">Basics</a>
                                    </li>
                                
                            </ul>
                        </div>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                
                            </ul>
                        </div>
                    </div>

                    <div class="markdown">
                        
    

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#dataset">Dataset</a></li>
<li><a href="#subset-a-dataset">Subset a dataset</a><ul>
<li><a href="#first-or-last-observations">First or last observations</a></li>
<li><a href="#random-sample-of-observations">Random sample of observations</a></li>
<li><a href="#based-on-row-or-column-numbers">Based on row or column numbers</a></li>
<li><a href="#based-on-variable-names">Based on variable names</a></li>
<li><a href="#based-on-one-or-multiple-criterion">Based on one or multiple criterion</a></li>
</ul></li>
<li><a href="#create-a-new-variable">Create a new variable</a><ul>
<li><a href="#transform-a-continuous-variable-into-a-categorical-variable">Transform a continuous variable into a categorical variable</a></li>
<li><a href="#sum-and-mean-in-rows">Sum and mean in rows</a></li>
<li><a href="#sum-and-mean-in-column">Sum and mean in column</a></li>
</ul></li>
<li><a href="#categorical-variables-and-labels-management">Categorical variables and labels management</a><ul>
<li><a href="#recode-categorical-variables">Recode categorical variables</a></li>
<li><a href="#change-reference-level">Change reference level</a></li>
</ul></li>
<li><a href="#rename-variable-names">Rename variable names</a></li>
<li><a href="#create-a-dataframe-manually">Create a dataframe manually</a></li>
<li><a href="#missing-values">Missing values</a><ul>
<li><a href="#remove-nas">Remove NAs</a></li>
<li><a href="#impute-nas">Impute NAs</a></li>
</ul></li>
<li><a href="#scale">Scale</a></li>
</ul>
</div>

<div class="figure">
<img src="/blog/data-manipulation-in-rstudio_files/0_voEJp2o-Z2k4-uUd.jpeg" alt="Photo by Campaign Creators" style="width:100.0%" />
<p class="caption">Photo by Campaign Creators</p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Not all datasets are as clean and tidy as you would expect. Therefore, after <a href="/blog/how-to-import-an-excel-file-in-rstudio/">importing your dataset into RStudio</a>, most of the time you will need to prepare it before performing any statistical analyses. Data manipulation can even sometimes take longer than the actual analyses when the quality of the data is poor. Data manipulation include a broad range of tools and techniques. We present here in details the manipulations that you will most likely need for your projects. Do not hesitate to let me know (as a comment at the end of this article for example) if you find other data manipulations essential so that I can add them.</p>
</div>
<div id="dataset" class="section level1">
<h1>Dataset</h1>
<p>In this article, we use the dataset <code>cars</code> to illustrate the different data manipulation techniques. Note that the dataset is installed by default in RStudio (so you do not need to import it) and I use the generic name <code>dat</code> as the name of the dataset throughout the article (see <a href="/blog/how-to-import-an-excel-file-in-rstudio/#user-friendly-way">here</a> why I always use a generic name instead of more specific names). Here is a table of the whole dataset:</p>
<pre class="r"><code>dat &lt;- cars # rename the cars dataset with a generic name
dat # display the entire dataset</code></pre>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
## 5      8   16
## 6      9   10
## 7     10   18
## 8     10   26
## 9     10   34
## 10    11   17
## 11    11   28
## 12    12   14
## 13    12   20
## 14    12   24
## 15    12   28
## 16    13   26
## 17    13   34
## 18    13   34
## 19    13   46
## 20    14   26
## 21    14   36
## 22    14   60
## 23    14   80
## 24    15   20
## 25    15   26
## 26    15   54
## 27    16   32
## 28    16   40
## 29    17   32
## 30    17   40
## 31    17   50
## 32    18   42
## 33    18   56
## 34    18   76
## 35    18   84
## 36    19   36
## 37    19   46
## 38    19   68
## 39    20   32
## 40    20   48
## 41    20   52
## 42    20   56
## 43    20   64
## 44    22   66
## 45    23   54
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85</code></pre>
<p>This dataset has 50 observations with 2 variables (speed and distance). You can check the number of observations and variables with <code>nrow(dat)</code> and <code>ncol(dat)</code>, or <code>dim(dat)</code>:</p>
<pre class="r"><code>nrow(dat) # number of rows/observations</code></pre>
<pre><code>## [1] 50</code></pre>
<pre class="r"><code>ncol(dat) # number of columns/variables</code></pre>
<pre><code>## [1] 2</code></pre>
<pre class="r"><code>dim(dat) # dimension: number of rows/observations and columns/variables</code></pre>
<pre><code>## [1] 50  2</code></pre>
<!-- library(pander) -->
<!-- pander(dat) -->
<!-- Note that the `pander()` command is only used for aesthetic reasons. You do not necessarily have to use them when you work in R Studio. -->
</div>
<div id="subset-a-dataset" class="section level1">
<h1>Subset a dataset</h1>
<div id="first-or-last-observations" class="section level2">
<h2>First or last observations</h2>
<ul>
<li>To keep only the first 10 observations:</li>
</ul>
<pre class="r"><code>head(dat, n = 10)</code></pre>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
## 5      8   16
## 6      9   10
## 7     10   18
## 8     10   26
## 9     10   34
## 10    11   17</code></pre>
<ul>
<li>To keep only the last 5 observations:</li>
</ul>
<pre class="r"><code>tail(dat, n = 5)</code></pre>
<pre><code>##    speed dist
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85</code></pre>
</div>
<div id="random-sample-of-observations" class="section level2">
<h2>Random sample of observations</h2>
<ul>
<li>To draw a sample of 4 observations without replacement:</li>
</ul>
<pre class="r"><code>library(dplyr)
sample_n(dat, 4, replace = FALSE)</code></pre>
<pre><code>##   speed dist
## 1    18   84
## 2    15   54
## 3    20   32
## 4    14   60</code></pre>
</div>
<div id="based-on-row-or-column-numbers" class="section level2">
<h2>Based on row or column numbers</h2>
<p>If you know what observation(s) or column(s) you want to keep, you can use the row or column number(s) to subset your dataset. We illustrate this with several examples:</p>
<ul>
<li>keep all the variables for the <span class="math inline">\(3^{rd}\)</span> observation:</li>
</ul>
<pre class="r"><code>dat[3, ]</code></pre>
<ul>
<li>keep the <span class="math inline">\(2^{nd}\)</span> variable for all observations:</li>
</ul>
<pre class="r"><code>dat[, 2]</code></pre>
<ul>
<li>You can mix the two above methods to keep only the <span class="math inline">\(2^{nd}\)</span> variable of the <span class="math inline">\(3^{rd}\)</span> observation:</li>
</ul>
<pre class="r"><code>dat[3, 2]</code></pre>
<pre><code>## [1] 4</code></pre>
<ul>
<li>keep several observations; for example observations <span class="math inline">\(1\)</span> to <span class="math inline">\(5\)</span>, the <span class="math inline">\(10^{th}\)</span> and the <span class="math inline">\(15^{th}\)</span> observation for all variables:</li>
</ul>
<pre class="r"><code>dat[c(1:5, 10, 15), ] # do not forget c()</code></pre>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
## 5      8   16
## 10    11   17
## 15    12   28</code></pre>
<ul>
<li>remove observations 5 to 45:</li>
</ul>
<pre class="r"><code>dat[-c(5:45), ]</code></pre>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85</code></pre>
<ul>
<li>tip: to keep only the last observation, use <code>nrow()</code> instead of the row number:</li>
</ul>
<pre class="r"><code>dat[nrow(dat), ] # nrow() gives the number of rows</code></pre>
<pre><code>##    speed dist
## 50    25   85</code></pre>
<p>This way, no matter the number of observations, you will always select the last one. This technique of using a piece of code instead of a specific value is to avoid “hard coding”. Hard coding is generally not recommended (unless you want to specify a parameter that you are sure will never change) because if your dataset changes, you will need to manually edit your code.</p>
<p>As you probably figured out by now, you can select observations and/or variables of a dataset by running <code>dataset_name[row_number, column_number]</code>. When the row or column number is left empty, the entire row/column is selected. Note that all examples presented above also works for matrices:</p>
<pre class="r"><code>mat &lt;- matrix(c(-1, 2, 0, 3), ncol = 2, nrow = 2)
mat</code></pre>
<pre><code>##      [,1] [,2]
## [1,]   -1    0
## [2,]    2    3</code></pre>
<pre class="r"><code>mat[1, 2]</code></pre>
<pre><code>## [1] 0</code></pre>
</div>
<div id="based-on-variable-names" class="section level2">
<h2>Based on variable names</h2>
<p>To select one variable of the dataset based on its name rather than on its column number, use <code>dataset_name$variable_name</code>:</p>
<pre class="r"><code>dat$speed</code></pre>
<pre><code>##  [1]  4  4  7  7  8  9 10 10 10 11 11 12 12 12 12 13 13 13 13 14 14 14 14 15 15
## [26] 15 16 16 17 17 17 18 18 18 18 19 19 19 20 20 20 20 20 22 23 24 24 24 24 25</code></pre>
<p>Accessing variables inside a dataset with this second method is strongly recommended compared to the first if you intend to modify the structure of your database. Indeed, if a column is added or removed in the dataset, the numbering will change. Therefore, variables are generally referred to by its name rather than by its position (column number). In addition, it is easier to understand and interpret code with the name of the variable written (another reason to call variables with a concise but clear name). There is only one reason why I would still use the column number; if the variables names are expected to change while the structure of the dataset do not change.</p>
<p>To select variables, it is also possible to use the <code>select()</code> command from the powerful <code>dplyr</code> package (for compactness only the first 6 observations are displayed thanks to the <code>head()</code> command):</p>
<pre class="r"><code>head(select(dat, speed))</code></pre>
<pre><code>##   speed
## 1     4
## 2     4
## 3     7
## 4     7
## 5     8
## 6     9</code></pre>
<p>This is equivalent than removing the distance variable:</p>
<pre class="r"><code>head(select(dat, -dist))</code></pre>
<pre><code>##   speed
## 1     4
## 2     4
## 3     7
## 4     7
## 5     8
## 6     9</code></pre>
</div>
<div id="based-on-one-or-multiple-criterion" class="section level2">
<h2>Based on one or multiple criterion</h2>
<p>Instead of subsetting a dataset based on row/column numbers or variable names, you can also subset it based on one or multiple criterion:</p>
<ul>
<li>keep only observations with speed larger than 20. The first argument refers to the name of the dataset, while the second argument refers to the subset criteria:</li>
</ul>
<pre class="r"><code>subset(dat, dat$speed &gt; 20)</code></pre>
<pre><code>##    speed dist
## 44    22   66
## 45    23   54
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85</code></pre>
<ul>
<li>keep only observations with distance smaller than or equal to 50 <strong>and</strong> speed equal to 10. Note the <code>==</code> (and not <code>=</code>) for the equal criteria:</li>
</ul>
<pre class="r"><code>subset(dat, dat$dist &lt;= 50 &amp; dat$speed == 10)</code></pre>
<pre><code>##   speed dist
## 7    10   18
## 8    10   26
## 9    10   34</code></pre>
<ul>
<li>use <code>|</code> to keep only observations with distance smaller than 20 <strong>or</strong> speed equal to 10:</li>
</ul>
<pre class="r"><code>subset(dat, dat$dist &lt; 20 | dat$speed == 10)</code></pre>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 5      8   16
## 6      9   10
## 7     10   18
## 8     10   26
## 9     10   34
## 10    11   17
## 12    12   14</code></pre>
<ul>
<li>to filter out some observations, use <code>!=</code>. For instance, to keep observations with speed not equal to 24 and distance not equal to 120 (for compactness only the last 6 observations are displayed thanks to the <code>tail()</code> command):</li>
</ul>
<pre class="r"><code>tail(subset(dat, dat$speed != 24 &amp; dat$dist != 120))</code></pre>
<pre><code>##    speed dist
## 41    20   52
## 42    20   56
## 43    20   64
## 44    22   66
## 45    23   54
## 50    25   85</code></pre>
</div>
</div>
<div id="create-a-new-variable" class="section level1">
<h1>Create a new variable</h1>
<p>Often a dataset can be enhanced by creating new variables based on other variables from the initial dataset. In this example, we create two new variables; one being the speed times the distance (which we call <code>speed_dist</code>) and the other being a categorization of the speed (which we call <code>speed_cat</code>). We then display the first 6 observations of this new dataset with the 4 variables:</p>
<pre class="r"><code># create new variable speed_dist
dat$speed_dist &lt;- dat$speed * dat$dist

# create new variable speed_cat
# the function ifelse() below means that if dat$speed &gt; 7, then speed_cat is &quot;high speed&quot;, otherwise it is &quot;low_speed&quot;
dat$speed_cat &lt;- ifelse(dat$speed &gt; 7,
  &quot;high speed&quot;, &quot;low speed&quot;
)

# display first 6 observations
head(dat) # 6 is the default in head()</code></pre>
<pre><code>##   speed dist speed_dist  speed_cat
## 1     4    2          8  low speed
## 2     4   10         40  low speed
## 3     7    4         28  low speed
## 4     7   22        154  low speed
## 5     8   16        128 high speed
## 6     9   10         90 high speed</code></pre>
<p>Note than in programming, a character string is generally surrounded by quotes (<code>&quot;character string&quot;</code>).</p>
<div id="transform-a-continuous-variable-into-a-categorical-variable" class="section level2">
<h2>Transform a continuous variable into a categorical variable</h2>
<p>To transform a continuous variable into a categorical variable (also known as qualitative variable):</p>
<pre class="r"><code>dat$speed_quali &lt;- cut(dat$speed,
  breaks = c(0, 12, 15, 19, 26), # cut points
  right = FALSE # closed on the left, open on the right
)
dat[c(1:2, 23:24, 49:50), ] # display some observations</code></pre>
<pre><code>##    speed dist speed_dist  speed_cat speed_quali
## 1      4    2          8  low speed      [0,12)
## 2      4   10         40  low speed      [0,12)
## 23    14   80       1120 high speed     [12,15)
## 24    15   20        300 high speed     [15,19)
## 49    24  120       2880 high speed     [19,26)
## 50    25   85       2125 high speed     [19,26)</code></pre>
<p>This transformation is often done on age, when the age (a continuous variable) is transformed into a qualitative variable representing different age groups.</p>
</div>
<div id="sum-and-mean-in-rows" class="section level2">
<h2>Sum and mean in rows</h2>
<p>In survey with Likert scale (used in psychology, among others), it is often the case that we need to compute a score for each respondents based on multiple questions. The score is usually the mean or the sum of all the questions of interest. This can be done with <code>rowMeans()</code> and <code>rowSums()</code>. For instance, let’s compute the mean and the sum of the variables <code>speed</code>, <code>dist</code> and <code>speed_dist</code> (variables must be numeric of course as sum and mean cannot be computed on qualitative variables!) for each row and store them under the variables <code>mean_score</code> and <code>total_score</code>:</p>
<pre class="r"><code>dat$mean_score &lt;- rowMeans(dat[, 1:3]) # variables speed, dist and speed_dist correspond to variables 1 to 3
dat$total_score &lt;- rowSums(dat[, 1:3])
head(dat)</code></pre>
<pre><code>##   speed dist speed_dist  speed_cat speed_quali mean_score total_score
## 1     4    2          8  low speed      [0,12)   4.666667          14
## 2     4   10         40  low speed      [0,12)  18.000000          54
## 3     7    4         28  low speed      [0,12)  13.000000          39
## 4     7   22        154  low speed      [0,12)  61.000000         183
## 5     8   16        128 high speed      [0,12)  50.666667         152
## 6     9   10         90 high speed      [0,12)  36.333333         109</code></pre>
</div>
<div id="sum-and-mean-in-column" class="section level2">
<h2>Sum and mean in column</h2>
<p>It is also possible to compute the mean and sum by column with <code>colMeans()</code> and <code>colSums()</code>:</p>
<pre class="r"><code>colMeans(dat[, 1:3])</code></pre>
<pre><code>##      speed       dist speed_dist 
##      15.40      42.98     769.64</code></pre>
<pre class="r"><code>colSums(dat[, 1:3])</code></pre>
<pre><code>##      speed       dist speed_dist 
##        770       2149      38482</code></pre>
</div>
</div>
<div id="categorical-variables-and-labels-management" class="section level1">
<h1>Categorical variables and labels management</h1>
<p>For categorical variables, it is a good practice to use the factor format and to name the different levels of the variables.</p>
<ul>
<li>for this example, let’s create another new variable called <code>dist_cat</code> based on the distance and then change its format from numeric to factor (while also specifying the labels of the levels):</li>
</ul>
<pre class="r"><code># create new variable dist_cat
dat$dist_cat &lt;- ifelse(dat$dist &lt; 15,
  1, 2
)

# change from numeric to factor and specify the labels
dat$dist_cat &lt;- factor(dat$dist_cat,
  levels = c(1, 2),
  labels = c(&quot;small distance&quot;, &quot;big distance&quot;) # follow the order of the levels
)

head(dat)</code></pre>
<pre><code>##   speed dist speed_dist  speed_cat speed_quali mean_score total_score
## 1     4    2          8  low speed      [0,12)   4.666667          14
## 2     4   10         40  low speed      [0,12)  18.000000          54
## 3     7    4         28  low speed      [0,12)  13.000000          39
## 4     7   22        154  low speed      [0,12)  61.000000         183
## 5     8   16        128 high speed      [0,12)  50.666667         152
## 6     9   10         90 high speed      [0,12)  36.333333         109
##         dist_cat
## 1 small distance
## 2 small distance
## 3 small distance
## 4   big distance
## 5   big distance
## 6 small distance</code></pre>
<ul>
<li>to check the format of a variable:</li>
</ul>
<pre class="r"><code>class(dat$dist_cat)</code></pre>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<pre class="r"><code># or
str(dat$dist_cat)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;small distance&quot;,..: 1 1 1 2 2 1 2 2 2 2 ...</code></pre>
<p>This will be sufficient if you need to format only a limited number of variables. However, if you need to do it for a large amount of categorical variables, it quickly becomes time consuming to write the same code many times. As you can imagine, it possible to format many variables without having to write the entire code for each variable one by one by using the <code>within()</code> command:</p>
<pre class="r"><code>dat &lt;- within(dat, {
  speed_cat &lt;- factor(speed_cat, labels = c(
    &quot;high speed&quot;,
    &quot;low speed&quot;
  ))
  dist_cat &lt;- factor(dist_cat, labels = c(
    &quot;small distance&quot;,
    &quot;big distance&quot;
  ))
})
head(dat)</code></pre>
<pre><code>##   speed dist speed_dist  speed_cat speed_quali mean_score total_score
## 1     4    2          8  low speed      [0,12)   4.666667          14
## 2     4   10         40  low speed      [0,12)  18.000000          54
## 3     7    4         28  low speed      [0,12)  13.000000          39
## 4     7   22        154  low speed      [0,12)  61.000000         183
## 5     8   16        128 high speed      [0,12)  50.666667         152
## 6     9   10         90 high speed      [0,12)  36.333333         109
##         dist_cat
## 1 small distance
## 2 small distance
## 3 small distance
## 4   big distance
## 5   big distance
## 6 small distance</code></pre>
<pre class="r"><code>str(dat)</code></pre>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  8 variables:
##  $ speed      : num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist       : num  2 10 4 22 16 10 18 26 34 17 ...
##  $ speed_dist : num  8 40 28 154 128 90 180 260 340 187 ...
##  $ speed_cat  : Factor w/ 2 levels &quot;high speed&quot;,&quot;low speed&quot;: 2 2 2 2 1 1 1 1 1 1 ...
##  $ speed_quali: Factor w/ 4 levels &quot;[0,12)&quot;,&quot;[12,15)&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean_score : num  4.67 18 13 61 50.67 ...
##  $ total_score: num  14 54 39 183 152 109 208 296 384 215 ...
##  $ dist_cat   : Factor w/ 2 levels &quot;small distance&quot;,..: 1 1 1 2 2 1 2 2 2 2 ...</code></pre>
<div id="recode-categorical-variables" class="section level2">
<h2>Recode categorical variables</h2>
<p>It is possible to recode labels of a categorical variable if you are not satisfied with the current labels. In this example, we change the labels as follows:</p>
<ul>
<li>“small distance” <span class="math inline">\(\rightarrow\)</span> “short distance”</li>
<li>“big distance” <span class="math inline">\(\rightarrow\)</span> “large distance”</li>
</ul>
<pre class="r"><code>dat$dist_cat &lt;- recode(dat$dist_cat,
  &quot;small distance&quot; = &quot;short distance&quot;,
  &quot;big distance&quot; = &quot;large distance&quot;
)
head(dat)</code></pre>
<pre><code>##   speed dist speed_dist  speed_cat speed_quali mean_score total_score
## 1     4    2          8  low speed      [0,12)   4.666667          14
## 2     4   10         40  low speed      [0,12)  18.000000          54
## 3     7    4         28  low speed      [0,12)  13.000000          39
## 4     7   22        154  low speed      [0,12)  61.000000         183
## 5     8   16        128 high speed      [0,12)  50.666667         152
## 6     9   10         90 high speed      [0,12)  36.333333         109
##         dist_cat
## 1 short distance
## 2 short distance
## 3 short distance
## 4 large distance
## 5 large distance
## 6 short distance</code></pre>
<!-- This will be sufficient if you need to recode only one variable. However, if you need to recode more than one variables without having to recode them one by one, another piece of code is necessary: -->
<!-- ```{r} -->
<!-- dat2 <- select(dat, c(speed_cat, dist_cat)) -->
<!-- dat2$speed_cat <- as.factor(dat$speed_cat) -->
<!-- dat2 <- apply(dat2, 2, function(x) { -->
<!--   x <- recode( -->
<!--     x, -->
<!--     "'small distance' = 'short distance'; -->
<!--     'big distance' = 'large distance'; -->
<!--     'low speed' = 'slow'; -->
<!--     'high speed' = 'fast'" -->
<!--   ) -->
<!--   x -->
<!-- }) -->
<!-- ``` -->
</div>
<div id="change-reference-level" class="section level2">
<h2>Change reference level</h2>
<p>For some analyses, you might want to change the order of the levels. For example, if you are analyzing data about a control group and a treatment group, you may want to set the control group as the reference group. By default, levels are ordered by alphabetical order or by its numeric value if it was change from numeric to factor.</p>
<ul>
<li>to check the current order of the levels (the first level being the reference):</li>
</ul>
<pre class="r"><code>levels(dat$dist_cat)</code></pre>
<pre><code>## [1] &quot;short distance&quot; &quot;large distance&quot;</code></pre>
<p>In this case, “short distance” being the first level it is the reference level. It is the first level because it was initially set with a value equal to 1 when creating the variable.</p>
<ul>
<li>to change the reference level:</li>
</ul>
<pre class="r"><code>dat$dist_cat &lt;- relevel(dat$dist_cat, ref = &quot;large distance&quot;)
levels(dat$dist_cat)</code></pre>
<pre><code>## [1] &quot;large distance&quot; &quot;short distance&quot;</code></pre>
<p>Large distance is now the first and thus the reference level.</p>
</div>
</div>
<div id="rename-variable-names" class="section level1">
<h1>Rename variable names</h1>
<p>To rename variable names, use the <code>rename()</code> command from the <code>dplyr</code> package as follows:</p>
<ul>
<li>dist <span class="math inline">\(\rightarrow\)</span> distance</li>
<li>speed_dist <span class="math inline">\(\rightarrow\)</span> speed_distance</li>
<li>dist_cat <span class="math inline">\(\rightarrow\)</span> distance_cat</li>
</ul>
<pre class="r"><code>dat &lt;- rename(dat,
  distance = dist,
  speed_distance = speed_dist,
  distance_cat = dist_cat
)
names(dat) # display variable names</code></pre>
<pre><code>## [1] &quot;speed&quot;          &quot;distance&quot;       &quot;speed_distance&quot; &quot;speed_cat&quot;     
## [5] &quot;speed_quali&quot;    &quot;mean_score&quot;     &quot;total_score&quot;    &quot;distance_cat&quot;</code></pre>
</div>
<div id="create-a-dataframe-manually" class="section level1">
<h1>Create a dataframe manually</h1>
<p>Although most analyses are performed on an imported dataset, it is also possible to create a dataframe directly in R:</p>
<pre class="r"><code># Create the data frame named dat
dat &lt;- data.frame(
  &quot;variable1&quot; = c(6, 12, NA, 3), # presence of 1 missing value
  &quot;variable2&quot; = c(3, 7, 9, 1),
  stringsAsFactors = FALSE
)
# Print the data frame
dat</code></pre>
<pre><code>##   variable1 variable2
## 1         6         3
## 2        12         7
## 3        NA         9
## 4         3         1</code></pre>
</div>
<div id="missing-values" class="section level1">
<h1>Missing values</h1>
<p>Missing values (represented by NA in RStudio, for “Not Applicable”) are often problematic for many analyses. For instance, the mean of a series or variable with at least one NA will give a NA (the dataframe created in the previous section is used for this example):</p>
<pre class="r"><code>mean(dat$variable1)</code></pre>
<pre><code>## [1] NA</code></pre>
<p>It is however possible to compute most measures for variables including at least one NA thanks to the argument <code>na.rm = TRUE</code>:</p>
<pre class="r"><code>mean(dat$variable1, na.rm = TRUE)</code></pre>
<pre><code>## [1] 7</code></pre>
<p>Nonetheless, datasets with NAs are still problematic for some types of analysis. Several alternatives exist to remove or impute missing values.</p>
<div id="remove-nas" class="section level2">
<h2>Remove NAs</h2>
<p>A simple solution is to remove all observations (i.e., rows) containing at least one missing value. This is done by keeping observations with complete cases:</p>
<pre class="r"><code>dat_complete &lt;- dat[complete.cases(dat), ]
dat_complete</code></pre>
<pre><code>##   variable1 variable2
## 1         6         3
## 2        12         7
## 4         3         1</code></pre>
<p>Be careful before removing observations with missing values, especially if missing values are not “missing at random”. This is, however, beyond the scope of the present article.</p>
</div>
<div id="impute-nas" class="section level2">
<h2>Impute NAs</h2>
<p>Instead of removing observations with at least one NA, it is possible to impute them, that is, replace them by some values such as the median or the mode of the variable. This can be done easily with the command <code>impute()</code> from the package <code>imputeMissings</code>:</p>
<pre class="r"><code>library(imputeMissings)
dat_imputed &lt;- impute(dat) # default method is median/mode
dat_imputed</code></pre>
<pre><code>##   variable1 variable2
## 1         6         3
## 2        12         7
## 3         6         9
## 4         3         1</code></pre>
<p>When the median/mode method is used (the default), character vectors and factors are imputed with the mode. Numeric and integer vectors are imputed with the median. Again, use imputations carefully. Other packages offer more advanced imputation techniques. However, we keep it simple and straightforward for this article as advanced imputations is beyond the scope of introductory data manipulations in R.</p>
</div>
</div>
<div id="scale" class="section level1">
<h1>Scale</h1>
<p>Scaling (i.e., standardizing) a variable is often used before a Principal Component Analysis (PCA)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> when variables of a dataset have different units. Remember that scaling a variable means that it will compute the mean and the standard deviation of that variable. Then each value (so each row) of that variable is “scaled” by subtracting the mean and dividing by the standard deviation of that variable. Formally:</p>
<p><span class="math display">\[z = \frac{x - \bar{x}}{s}\]</span></p>
<p>where <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(s\)</span> are the mean and the standard deviation of the variable, respectively.</p>
<p>To scale one or more variables in R use <code>scale()</code>:</p>
<pre class="r"><code>dat_scaled &lt;- scale(dat_imputed)
head(dat_scaled)</code></pre>
<pre><code>##       variable1  variable2
## [1,] -0.1986799 -0.5477226
## [2,]  1.3907590  0.5477226
## [3,] -0.1986799  1.0954451
## [4,] -0.9933993 -1.0954451</code></pre>
<p>Thanks for reading. I hope this article helped you to manipulate your data in RStudio.</p>
<p>As always, if you have a question or a suggestion related to the topic covered in this article, please add it as a comment so other readers can benefit from the discussion. If you find a mistake or bug, you can inform me by <a href="https://github.com/AntoineSoetewey/statsandr/issues" target="_blank" rel="noopener">raising an issue on GitHub</a>. For all other requests, you can contact me <a href="/contact/">here</a>.</p>
<p>Get updates every time a new article is published by <a href="/subscribe/">subscribing to this blog</a>.</p>
<p><strong>Related articles:</strong></p>
<script src="//rss.bloople.net/?url=https%3A%2F%2Fwww.statsandr.com%2Ftags%2Fr%2Findex.xml&detail=-1&limit=5&showtitle=false&type=js"></script>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Principal Component Analysis (PCA) is a useful technique for exploratory data analysis, allowing a better visualization of the variation present in a dataset with a large number of variables. When there are many variables, the data cannot easily be illustrated in their raw format. To counter this, the PCA takes a dataset with many variables and simplifies it by transforming the original variables into a smaller number of “principal components”. The first dimension contains the most variance in the dataset and so on, and the dimensions are uncorrelated. Note that PCA is done on quantitative variables.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>



                    </div>

                    
                        <div class="navigation">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-left">
                                            <a href="/blog/how-to-import-an-excel-file-in-rstudio/">« How to import an Excel file in RStudio</a>
                                        </div>
                                    
                                </div>
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-right">
                                            <a href="/blog/how-to-create-an-interactive-booklist-with-automatic-amazon-affiliate-links-in-r/">How to create an interactive booklist with automatic Amazon affiliate links in R »</a>
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                    
                </div>
            </div>
        </div>
    </div>

    <section id="comments">

      <div class="py-3 content">
            <div class="container">
                  <div class="row justify-content-center">
                        <div class="col-sm-12 col-md-10">
                              <div class="comments">
                                    <div id="disqus_thread"></div>
                              </div>
                        </div>
                  </div>
            </div>
      </div>

      <script type="text/javascript">
            (function () {
                  
                  
                  if (window.location.hostname == "localhost")
                        return;

                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  var disqus_shortname = 'statsandr';
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
      </script>
      <noscript>
            Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
      </noscript>
</section>
    <div class="my-4 footer">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-md-5">
                
                    <div class="mx-0 mx-md-4 text-left">
                        
                            <p>
                              <a href="/subscribe/">Subscribe</a>
                              <a href="/sitemap/">Sitemap</a>
                              <a href="/support/">Support</a>
                              <a href="/terms/">Terms</a>
                              <a href="/links/">Links</a>
                              
                              




  



<a href='https://github.com/AntoineSoetewey/statsandr/edit/master/content/blog/data-manipulation-in-rstudio.Rmd' target="_blank">Edit</a>



                              
                            </p>
                            <p>
                              <a href="/">&copy; <script>document.write(new Date().getFullYear())</script> Antoine Soetewey</a>
                            </p>
                        
                    </div>
                
            </div>
            <div class="col-sm-12 col-md-5">
                <div class="mx-0 mx-md-4 text-right">
                  
                    
                    <a href="https://medium.com/@ant.soetewey" target="_blank">
                        <img class="icon" src="/img/medium.svg" alt="Medium" />
                    </a>
                    
                    
                    
                        <a href="https://github.com/AntoineSoetewey" target="_blank">
                            <img class="icon" src="/img/github.svg" alt="GitHub" />
                        </a>
                    

                    

                    

                    

                    

                    

                    

                    
                    
                    
                    <a href="/contact/">
                        <img class="icon" src="/img/email.svg" alt="Contact" />
                    </a>
                    

                    
                        <a href="/index.xml" class="mr-0">
                            <img class="icon" src="/img/rss.svg" alt="RSS" />
                        </a>
                    

                    
                </div>
            </div>
        </div>
    </div>
</div>



    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" integrity="sha256-sNPiigbfSkqUzMc5rgrdztLnneCMAp6W9wetJUZu9Zw=" crossorigin="anonymous"></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-86997981-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
        
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>
